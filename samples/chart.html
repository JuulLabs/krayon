<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Krayon | Cross platform (Android, iOS &amp; JavaScript) canvas library.</title>
<meta name="generator" content="Jekyll v4.4.1">
<meta property="og:title" content="Krayon">
<meta property="og:locale" content="en_US">
<meta name="description" content="Cross platform (Android, iOS &amp; JavaScript) canvas library.">
<meta property="og:description" content="Cross platform (Android, iOS &amp; JavaScript) canvas library.">
<meta property="og:site_name" content="Krayon">
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="Krayon">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Cross platform (Android, iOS &amp; JavaScript) canvas library.","headline":"Krayon","url":"/krayon/samples/chart.html"}</script>
<!-- End Jekyll SEO tag -->
<link id="main-stylesheet" rel="stylesheet" href="/krayon/assets/css/style.css">
<link type="application/atom+xml" rel="alternate" href="/krayon/feed.xml" title="Krayon">
<script src="/krayon/assets/js/sample.js"></script>
</head>
<body>
<header class="site-header">

    <div class="wrapper">
<a class="site-title" rel="author" href="/krayon/"><img src="/krayon/assets/images/krayon.svg" height="35px"></a><nav class="site-nav">
            <input type="checkbox" id="nav-trigger" class="nav-trigger">
            <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewbox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
            </svg>
          </span>
            </label>

            <div class="trigger">
<a class="page-link" href="/krayon/api/">API</a><a class="page-link" href="/krayon/modules/">Modules</a><a class="page-link" href="/krayon/samples/">Samples</a><a class="page-link" href="/krayon/tutorial/">Tutorial</a>
</div>
        </nav>
</div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title"></h1>
  </header>

  <div class="post-content">
    <canvas id="chart" style="height: 480px; width: 854px"></canvas>
<script>sample.setupInteractiveChart(document.getElementById("chart"));</script>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="nn">com.juul.krayon.sample</span>

<span class="k">import</span> <span class="nn">com.juul.krayon.box.setShapeFrom</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.color.Color</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.color.crimson</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.color.darkBlue</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.color.forestGreen</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.color.lerp</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.color.white</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.element.ClickHandler</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.element.HoverHandler</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.element.RectangleElement</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.element.RootElement</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.element.TextElement</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.element.UpdateElement</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.hierarchy.flatHierarchy</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.hierarchy.removeHierarchy</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.hierarchy.sum</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.hierarchy.treemap.Treemap</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.hierarchy.treemap.layoutWith</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.kanvas.Font</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.kanvas.Paint</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.kanvas.Paint.Fill</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.kanvas.Paint.Text</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.kanvas.Paint.Text.Alignment.Center</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.kanvas.sansSerif</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.scale.max</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.scale.min</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.selection.append</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.selection.asSelection</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.selection.data</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.selection.each</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.selection.join</span>
<span class="k">import</span> <span class="nn">com.juul.krayon.selection.selectAll</span>
<span class="k">import</span> <span class="nn">kotlinx.coroutines.flow.Flow</span>
<span class="k">import</span> <span class="nn">kotlinx.coroutines.flow.MutableStateFlow</span>
<span class="k">import</span> <span class="nn">kotlinx.coroutines.flow.combine</span>
<span class="k">import</span> <span class="nn">kotlin.random.Random</span>

<span class="k">enum</span> <span class="kd">class</span> <span class="nc">Letter</span> <span class="p">{</span>
    <span class="nc">Alpha</span><span class="p">,</span>
    <span class="nc">Beta</span><span class="p">,</span>
    <span class="nc">Gamma</span><span class="p">,</span>
    <span class="nc">Delta</span><span class="p">,</span>
    <span class="nc">Epsilon</span><span class="p">,</span>
    <span class="nc">Zeta</span><span class="p">,</span>
    <span class="nc">Eta</span><span class="p">,</span>
    <span class="nc">Theta</span><span class="p">,</span>
    <span class="nc">Iota</span><span class="p">,</span>
    <span class="nc">Kappa</span><span class="p">,</span>
<span class="p">}</span>

<span class="kd">data class</span> <span class="nc">InteractiveTreeChart</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">selection</span><span class="p">:</span> <span class="nc">Letter</span><span class="p">?,</span>
    <span class="kd">val</span> <span class="py">hovered</span><span class="p">:</span> <span class="nc">Letter</span><span class="p">?,</span>
    <span class="kd">val</span> <span class="py">counts</span><span class="p">:</span> <span class="nc">Map</span><span class="p">&lt;</span><span class="nc">Letter</span><span class="p">,</span> <span class="nc">Int</span><span class="p">&gt;,</span>
<span class="p">)</span>

<span class="k">internal</span> <span class="k">fun</span> <span class="nf">interactiveTreeChart</span><span class="p">():</span> <span class="nc">Pair</span><span class="p">&lt;</span><span class="nc">Flow</span><span class="p">&lt;</span><span class="nc">InteractiveTreeChart</span><span class="p">&gt;,</span> <span class="nc">UpdateElement</span><span class="p">&lt;</span><span class="nc">InteractiveTreeChart</span><span class="p">&gt;&gt;</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">selectionState</span> <span class="p">=</span> <span class="nc">MutableStateFlow</span><span class="p">(</span><span class="k">null</span> <span class="k">as</span> <span class="nc">Letter</span><span class="p">?)</span>
    <span class="kd">val</span> <span class="py">hoveredState</span> <span class="p">=</span> <span class="nc">MutableStateFlow</span><span class="p">(</span><span class="k">null</span> <span class="k">as</span> <span class="nc">Letter</span><span class="p">?)</span>
    <span class="kd">val</span> <span class="py">letterSizes</span> <span class="p">=</span> <span class="nc">Letter</span><span class="p">.</span><span class="nf">values</span><span class="p">().</span><span class="nf">associateWith</span> <span class="p">{</span> <span class="nc">Random</span><span class="p">.</span><span class="nf">nextInt</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span> <span class="p">}</span>
    <span class="kd">val</span> <span class="py">dataFlow</span> <span class="p">=</span> <span class="nf">combine</span><span class="p">(</span><span class="n">selectionState</span><span class="p">,</span> <span class="n">hoveredState</span><span class="p">)</span> <span class="p">{</span> <span class="n">selection</span><span class="p">,</span> <span class="n">hovered</span> <span class="p">-&gt;</span>
        <span class="nc">InteractiveTreeChart</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span> <span class="n">hovered</span><span class="p">,</span> <span class="n">letterSizes</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="kd">val</span> <span class="py">updater</span> <span class="p">=</span> <span class="nc">UpdateElement</span><span class="p">&lt;</span><span class="nc">InteractiveTreeChart</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">root</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">data</span> <span class="p">-&gt;</span>
        <span class="nf">updateInteractiveTreeChart</span><span class="p">(</span>
            <span class="n">root</span><span class="p">,</span>
            <span class="n">width</span><span class="p">,</span>
            <span class="n">height</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">clickHandler</span> <span class="p">=</span> <span class="p">{</span> <span class="n">letter</span> <span class="p">-&gt;</span> <span class="n">selectionState</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="n">letter</span><span class="p">.</span><span class="nf">takeUnless</span> <span class="p">{</span> <span class="n">it</span> <span class="p">==</span> <span class="n">selectionState</span><span class="p">.</span><span class="n">value</span> <span class="p">}</span> <span class="p">},</span>
            <span class="n">hoverHandler</span> <span class="p">=</span> <span class="p">{</span> <span class="n">letter</span><span class="p">,</span> <span class="n">hovered</span> <span class="p">-&gt;</span>
                <span class="k">if</span> <span class="p">(!</span><span class="n">hovered</span> <span class="p">&amp;&amp;</span> <span class="n">hoveredState</span><span class="p">.</span><span class="n">value</span> <span class="p">==</span> <span class="n">letter</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">hoveredState</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="k">null</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">hovered</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">hoveredState</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="n">letter</span>
                <span class="p">}</span>
            <span class="p">},</span>
        <span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">dataFlow</span> <span class="n">to</span> <span class="n">updater</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">fun</span> <span class="nf">updateInteractiveTreeChart</span><span class="p">(</span>
    <span class="n">root</span><span class="p">:</span> <span class="nc">RootElement</span><span class="p">,</span>
    <span class="n">width</span><span class="p">:</span> <span class="nc">Float</span><span class="p">,</span>
    <span class="n">height</span><span class="p">:</span> <span class="nc">Float</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="nc">InteractiveTreeChart</span><span class="p">,</span>
    <span class="n">clickHandler</span><span class="p">:</span> <span class="nc">ClickHandler</span><span class="p">&lt;</span><span class="nc">Letter</span><span class="p">&gt;,</span>
    <span class="n">hoverHandler</span><span class="p">:</span> <span class="nc">HoverHandler</span><span class="p">&lt;</span><span class="nc">Letter</span><span class="p">&gt;,</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">min</span> <span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="n">counts</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">min</span> <span class="p">{</span> <span class="n">it</span> <span class="p">}</span>
    <span class="kd">val</span> <span class="py">max</span> <span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="n">counts</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">max</span> <span class="p">{</span> <span class="n">it</span> <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">colorFor</span><span class="p">(</span><span class="n">letter</span><span class="p">:</span> <span class="nc">Letter</span><span class="p">):</span> <span class="nc">Color</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">value</span> <span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="n">counts</span><span class="p">[</span><span class="n">letter</span><span class="p">]</span> <span class="o">?:</span> <span class="mi">0</span>
        <span class="kd">val</span> <span class="py">baseColor</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">letter</span> <span class="p">==</span> <span class="n">data</span><span class="p">.</span><span class="n">selection</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">forestGreen</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">lerp</span><span class="p">(</span><span class="n">crimson</span><span class="p">,</span> <span class="n">darkBlue</span><span class="p">,</span> <span class="p">(</span><span class="n">value</span> <span class="p">-</span> <span class="n">min</span><span class="p">).</span><span class="nf">toFloat</span><span class="p">()</span> <span class="p">/</span> <span class="p">(</span><span class="n">max</span> <span class="p">-</span> <span class="n">min</span><span class="p">))</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">if</span> <span class="p">(</span><span class="n">letter</span> <span class="p">==</span> <span class="n">data</span><span class="p">.</span><span class="n">hovered</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">lerp</span><span class="p">(</span><span class="n">baseColor</span><span class="p">,</span> <span class="n">white</span><span class="p">,</span> <span class="mf">0.25f</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">baseColor</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">val</span> <span class="py">lettersToTiles</span> <span class="p">=</span> <span class="nf">flatHierarchy</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">counts</span><span class="p">.</span><span class="n">entries</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">sum</span> <span class="p">{</span> <span class="n">it</span><span class="o">?.</span><span class="n">value</span><span class="o">?.</span><span class="nf">toFloat</span><span class="p">()</span> <span class="o">?:</span> <span class="mf">0f</span> <span class="p">}</span>
        <span class="p">.</span><span class="nf">layoutWith</span><span class="p">(</span><span class="nc">Treemap</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span>
        <span class="p">.</span><span class="nf">removeHierarchy</span><span class="p">()</span>
        <span class="p">.</span><span class="nf">toList</span><span class="p">()</span>

    <span class="n">root</span><span class="p">.</span><span class="nf">asSelection</span><span class="p">()</span>
        <span class="p">.</span><span class="nf">selectAll</span><span class="p">(</span><span class="nc">RectangleElement</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">data</span><span class="p">(</span><span class="n">lettersToTiles</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">join</span> <span class="p">{</span> <span class="nf">append</span><span class="p">(</span><span class="nc">RectangleElement</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">.</span><span class="nf">each</span> <span class="p">{</span> <span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="p">-&gt;</span>
            <span class="kd">val</span> <span class="p">(</span><span class="py">entry</span><span class="p">,</span> <span class="py">tile</span><span class="p">)</span> <span class="p">=</span> <span class="n">d</span>
            <span class="nf">setShapeFrom</span><span class="p">(</span><span class="n">tile</span><span class="p">)</span>
            <span class="n">paint</span> <span class="p">=</span> <span class="nc">Paint</span><span class="p">.</span><span class="nc">FillAndStroke</span><span class="p">(</span>
                <span class="nc">Fill</span><span class="p">(</span><span class="nf">colorFor</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">key</span><span class="p">)),</span>
                <span class="nc">Paint</span><span class="p">.</span><span class="nc">Stroke</span><span class="p">(</span><span class="n">white</span><span class="p">,</span> <span class="mf">2f</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="nf">onClick</span> <span class="p">{</span> <span class="n">clickHandler</span><span class="p">.</span><span class="nf">onClick</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">key</span><span class="p">)</span> <span class="p">}</span>
            <span class="nf">onHoverChanged</span> <span class="p">{</span> <span class="n">_</span><span class="p">,</span> <span class="n">hovered</span> <span class="p">-&gt;</span> <span class="n">hoverHandler</span><span class="p">.</span><span class="nf">onHoverChanged</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">key</span><span class="p">,</span> <span class="n">hovered</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">}</span>

    <span class="kd">val</span> <span class="py">textPaint</span> <span class="p">=</span> <span class="nc">Text</span><span class="p">(</span><span class="n">white</span><span class="p">,</span> <span class="n">size</span> <span class="p">=</span> <span class="mf">12f</span><span class="p">,</span> <span class="n">alignment</span> <span class="p">=</span> <span class="nc">Center</span><span class="p">,</span> <span class="nc">Font</span><span class="p">(</span><span class="n">sansSerif</span><span class="p">))</span>
    <span class="n">root</span><span class="p">.</span><span class="nf">asSelection</span><span class="p">()</span>
        <span class="p">.</span><span class="nf">selectAll</span><span class="p">(</span><span class="nc">TextElement</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">data</span><span class="p">(</span><span class="n">lettersToTiles</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">join</span> <span class="p">{</span> <span class="nf">append</span><span class="p">(</span><span class="nc">TextElement</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">.</span><span class="nf">each</span> <span class="p">{</span> <span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="p">-&gt;</span>
            <span class="kd">val</span> <span class="p">(</span><span class="py">entry</span><span class="p">,</span> <span class="py">tile</span><span class="p">)</span> <span class="p">=</span> <span class="n">d</span>
            <span class="n">x</span> <span class="p">=</span> <span class="n">tile</span><span class="p">.</span><span class="n">centerX</span>
            <span class="n">y</span> <span class="p">=</span> <span class="n">tile</span><span class="p">.</span><span class="n">centerY</span> <span class="p">+</span> <span class="n">textPaint</span><span class="p">.</span><span class="n">size</span> <span class="p">*</span> <span class="mf">0.75f</span>
            <span class="n">text</span> <span class="p">=</span> <span class="n">entry</span><span class="p">.</span><span class="n">key</span><span class="p">.</span><span class="n">name</span>
            <span class="n">paint</span> <span class="p">=</span> <span class="n">textPaint</span>
        <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
    <data class="u-url" href="/krayon/"></data>

    <div class="wrapper">

        <div class="footer-col-wrapper">
            <div class="footer-col">
                <p class="feed-subscribe">
                    <a href="https://github.com/JuulLabs/krayon">
                        <img alt="GitHub" src="/krayon/assets/images/github-mark.svg" width="35px">
                        Â 
                        <span>Fork me on GitHub</span>
                    </a>
                </p>
            </div>
            <div class="footer-col">
                <p>Cross platform (Android, iOS &amp; JavaScript) canvas library.</p>
            </div>
        </div>

        <div class="social-links">
<ul class="social-media-list">
  <li>
    <a href="/krayon/feed.xml" target="_blank" title="Subscribe to syndication feed">
      <svg class="svg-icon grey" viewbox="0 0 16 16">
        <path d="M12.8 16C12.8 8.978 7.022 3.2 0 3.2V0c8.777 0 16 7.223 16 16h-3.2zM2.194
          11.61c1.21 0 2.195.985 2.195 2.196 0 1.21-.99 2.194-2.2 2.194C.98 16 0 15.017 0
          13.806c0-1.21.983-2.195 2.194-2.195zM10.606
          16h-3.11c0-4.113-3.383-7.497-7.496-7.497v-3.11c5.818 0 10.606 4.79 10.606 10.607z"></path>
      </svg>
    </a>
  </li>
</ul>
</div>

    </div>

</footer>

</body>

</html>
